API и Архитектура (Анализ логов)

1. В данном случае произошло двойное списание денег. Отправка два раза POST запроса и получение два раза статуса кода – 200 ОК.
Клиент отправил один и тот же запрос 2 раза — сервер обработал оба как независимые операции.
В конечном счете у пользователя списалось 200 вместо 100 руб.
2. Необходимо реализовать идемпотентность запросов на уровне API.
3. Для POST  запроса реализовать с помощью специальных ключей (Idempotency Key),  который добавляется в заголовок или тело запроса.
Если тот же ключ придёт повторно — сервер должен вернуть результат первой операции.

Баг-репорт.
Описание: Двойное списание при повторной отправке запроса POST /api/transfer 
в мобильном приложении.

Предусловие: быть авторизованным.
Шаги воспроизведения:
1. Отправить запрос  POST /api/transfer   на списание 100 руб.
2. Сымитировать плохой интернет через  network throttling.
3. Отправить  повторный запрос  POST /api/transfer на списание 100 руб с тем же телом и теми же параметрами.
4. Проверить баланс.

Ожидаемый результат:  Получение от сервера успешное списание 100 руб при отправке первого запроса.
Фактический результат: Деньги списаны дважды.

Приоритет:Critical
Тестовое устройство:
Ссылка на CURL запроса:
Ссылка на документацию.
Скриншот/скринкаст.
Ссылка на логи Kibana или Sentry.





Траблшутинг (Root Cause Analysis)
1.“An error occurred (AccessDenied)”
Неправильные права доступа.
2. В данном случае на DevOps, так как DevOps политики доступа и разрешения сервисов.

Баг-репорт.
Описание: « UploadService не имеет прав на запись в S3 — ошибка AccessDenied при выполнении PutObject»
Предусловие: 
Пользователь авторизован.
Шаги воспроизведения:
1.Нажать кнопку «Загрузить аватар».
2.Выбрать корректный файл.
3.Подтвердить загрузку и дождаться ответа.

Ожидаемый результат: На фронтенде отображается обновлённый аватар. Backend возвращает 200 OK.
Фактический результат: Фронтенд отображает сообщение: «Сервис временно недоступен».

Приоритет:Critical
Тестовое устройство:
Ссылка на CURL запроса:
Ссылка на документацию.
Скриншот/скринкаст.
Ссылка на логи Kibana или Sentry.






Тест-дизайн (Security & Logic)
 Первая проверка – отправляю запрос с таким телом ( вместо "user_id": 100, отправляю   "user_id": 101)

{
  "user_id": 101,
  "email": "test@test.com",
  "role": "user"
}
Ожидаемый результат: сервер отклоняет запрос с клиентской ошибкой.

Вторая проверка - отправляю запрос с таким телом ("user" меняю роль на admin)
{
  "user_id": 100,
  "email": "test@test.com",
  "role": " admin "
}

Ожидаемый результат:  403 Forbidden – нет прав, клиентская ошибка.


Баг-репорт.
Описание: Пользователь может изменить профиль другого пользователя при вызове PUT /api/users/update.

Предусловие: 
Токен авторизации принадлежит пользователю ID = 100.
В системе существует другой пользователь — ID = 101.

Шаги воспроизведения:

1. Сформировать запрос PUT /api/users/update с заголовком - токен авторизации для user_id=100 c body:

{"user_id": 101,
 "email": "new@test.com",
 "role": "user"}

2. Выполнить запрос.
Ожидаемый результат: Сервер должен отклонить попытку изменить профиль другого пользователя, клиентская ошибка 403 - нет прав.

Фактический результат: Сервер не проводит проверку валидации. Профиль пользователя 101 успешно обновлён, несмотря на то, что запрос выполнен под токеном пользователя 100.

Приоритет:Critical
Тестовое устройство:
Ссылка на CURL запроса:
Ссылка на документацию.
Скриншот / скринкаст.
Можно добавить информацию из базы данных (как дополнительно).
Ссылка на логи Kibana или Sentry.

Баг- репорт.
Описание: Пользователь может повысить себе роль до admin через PUT /api/users/update.
Предусловие:
Пользователь авторизован.
Шаги воспроизведения:
1. Выполнить PUT /api/users/update с токеном для  user_id=100
2. Передать в теле запроса:
{  "user_id": 100,
    "email": "test@test.com",
    "role": "admin"}
2. Отправить запрос.

Ожидаемый результат:
Пользователь с ролью user не должен иметь возможности выполнять административные действия, клиентская ошибка 403.

Фактический результат: Роль пользователя успешно изменилась с user  на  admin.

Приоритет:Critical
Тестовое устройство:
Ссылка на CURL запроса:
Ссылка на документацию.
Скриншот / скринкаст.
Можно добавить информацию из базы данных (как дополнительно).
Ссылка на логи Kibana или Sentry.

